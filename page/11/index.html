<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-tw">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="google-site-verification" content="Ovk0hBXjKPPKtg5oCm39lxBF-ASTmfYJwoxb1aUUOEo" />


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Jay's Code" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="慢慢學習。">
<meta property="og:type" content="website">
<meta property="og:title" content="Jay's Code">
<meta property="og:url" content="http://windsuzu.github.io/page/11/index.html">
<meta property="og:site_name" content="Jay's Code">
<meta property="og:description" content="慢慢學習。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jay's Code">
<meta name="twitter:description" content="慢慢學習。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://windsuzu.github.io/page/11/"/>





  <title> Jay's Code </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-tw">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jay's Code</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Study Recording</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分類
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            標籤
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            檢索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://windsuzu.github.io/leetcode-617/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jay Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Code">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/leetcode-617/" itemprop="url">
                  LeetCode#617 Merge Two Binary Trees - in Swift
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2017-07-25T23:50:46+08:00">
                2017-07-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/Swift/Tree/" itemprop="url" rel="index">
                    <span itemprop="name">Tree</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/leetcode-617/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="leetcode-617/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="題目"><a href="#題目" class="headerlink" title="題目"></a>題目</h1><p>Given two binary trees and imagine that when you put one of them to cover the other, some nodes of the two trees are overlapped while the others are not.</p>
<p>給你兩個二元樹，想像當其中一棵樹覆蓋對方時，某些節點可能會重疊，某些可能不會。</p>
<p>You need to merge them into a new binary tree. The merge rule is that if two nodes overlap, then sum node values up as the new value of the merged node. Otherwise, the NOT null node will be used as the node of new tree.</p>
<p>你必須要合併兩棵樹變成一棵新的二元樹。合併規則是這樣：如果兩個節點重疊，那就相加兩個值變成新的節點，如果有一個值不存在，就由不為空的值成為新的節點。</p>
<p>Example 1:<br> Input:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Tree 1                     Tree 2</div><div class="line">     1                         2</div><div class="line">    / \                       / \</div><div class="line">   3   2                     1   3</div><div class="line">  /                           \   \</div><div class="line"> 5                             4   7</div></pre></td></tr></table></figure></p>
<p>Output:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Merged tree:</div><div class="line">    3</div><div class="line">   / \</div><div class="line">  4   5</div><div class="line"> / \   \</div><div class="line">5   4   7</div></pre></td></tr></table></figure></p>
<p>Note: The merging process must start from the root nodes of both trees.</p>
<p>合併的過程必須從兩棵樹的最頂端開始。</p>
<p>Definition for a binary tree node.</p>
<p>TreeNode 類別長得像這樣</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">var</span> val: <span class="type">Int</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">var</span> <span class="keyword">left</span>: <span class="type">TreeNode</span>?</div><div class="line">    <span class="keyword">public</span> <span class="keyword">var</span> <span class="keyword">right</span>: <span class="type">TreeNode</span>?</div><div class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> val: <span class="type">Int</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.val = val</div><div class="line">        <span class="keyword">self</span>.<span class="keyword">left</span> = <span class="literal">nil</span></div><div class="line">        <span class="keyword">self</span>.<span class="keyword">right</span> = <span class="literal">nil</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="第一次解題-Accepted"><a href="#第一次解題-Accepted" class="headerlink" title="第一次解題 : Accepted"></a>第一次解題 : Accepted</h1><p>首先針對每個 TreeNode 進行判斷與運算</p>
<ol>
<li>如果點1或點2都是空值就返回空值</li>
<li>如果點1或點2都不是空值就要將兩個值相加</li>
<li>如果點1是空值 ? 就返回點2 : 返回點1</li>
</ol>
<p>接著利用遞迴函式 ( Recursive Function ) 的方式<br>對接下來的左邊節點與右邊節點進行運算得到結果</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">mergeTrees</span><span class="params">(<span class="number">_</span> t1: TreeNode?, <span class="number">_</span> t2: TreeNode?)</span></span> -&gt; <span class="type">TreeNode</span>? &#123;</div><div class="line">    <span class="keyword">var</span> newNode: <span class="type">TreeNode</span>? = <span class="literal">nil</span></div><div class="line">    </div><div class="line">    <span class="keyword">if</span> t1 == <span class="literal">nil</span> &amp;&amp; t2 == <span class="literal">nil</span> &#123;</div><div class="line">        <span class="keyword">return</span> newNode</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> t1 != <span class="literal">nil</span> &amp;&amp; t2 != <span class="literal">nil</span> &#123;</div><div class="line">        newNode = <span class="type">TreeNode</span>(t1!.val + t2!.val)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        newNode = t1 == <span class="literal">nil</span> ? t2 : t1</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    newNode?.<span class="keyword">left</span> = mergeTrees(t1?.<span class="keyword">left</span>, t2?.<span class="keyword">left</span>)</div><div class="line">    newNode?.<span class="keyword">right</span> = mergeTrees(t1?.<span class="keyword">right</span>, t2?.<span class="keyword">right</span>)</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> newNode</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://windsuzu.github.io/leetcode-595/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jay Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Code">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/leetcode-595/" itemprop="url">
                  LeetCode#595 Big Countries - in MySQL
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2017-07-24T09:03:46+08:00">
                2017-07-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/leetcode-595/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="leetcode-595/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="題目"><a href="#題目" class="headerlink" title="題目"></a>題目</h1><p>這裡有一個 Table 叫作 “World”<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">+-----------------+------------+------------+--------------+---------------+</div><div class="line">| name            | continent  | area       | population   | gdp           |</div><div class="line">+-----------------+------------+------------+--------------+---------------+</div><div class="line">| Afghanistan     | Asia       | 652230     | 25500100     | 20343000      |</div><div class="line">| Albania         | Europe     | 28748      | 2831741      | 12960000      |</div><div class="line">| Algeria         | Africa     | 2381741    | 37100000     | 188681000     |</div><div class="line">| Andorra         | Europe     | 468        | 78115        | 3712000       |</div><div class="line">| Angola          | Africa     | 1246700    | 20609294     | 100990000     |</div><div class="line">+-----------------+------------+------------+--------------+---------------+</div></pre></td></tr></table></figure></p>
<p> 一個大的國家，必須要達成 「 area 超過 3000000 」 或是 「 population 超過 25000000 」</p>
<p> 現在請你撰寫一個 SQL QUERY 找出大的國家，並且列出他的 ‘name, population, area’</p>
<p> 依照上面的表格所示，查詢後的結果應該跟下表一樣:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">+--------------+-------------+--------------+</div><div class="line">| name         | population  | area         |</div><div class="line">+--------------+-------------+--------------+</div><div class="line">| Afghanistan  | 25500100    | 652230       |</div><div class="line">| Algeria      | 37100000    | 2381741      |</div><div class="line">+--------------+-------------+--------------+</div></pre></td></tr></table></figure>
<h1 id="第一次解題-Accepted"><a href="#第一次解題-Accepted" class="headerlink" title="第一次解題 : Accepted"></a>第一次解題 : Accepted</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, population, area </div><div class="line"><span class="keyword">FROM</span> World </div><div class="line"><span class="keyword">WHERE</span> area &gt; <span class="number">3000000</span> <span class="keyword">OR</span> population &gt; <span class="number">25000000</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://windsuzu.github.io/leetcode-461/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jay Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Code">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/leetcode-461/" itemprop="url">
                  LeetCode#461 Hamming distance - in Swift
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2017-07-23T09:03:46+08:00">
                2017-07-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/Swift/Bit-Manipulation/" itemprop="url" rel="index">
                    <span itemprop="name">Bit Manipulation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/leetcode-461/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="leetcode-461/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="題目"><a href="#題目" class="headerlink" title="題目"></a>題目</h1><p>The Hamming distance between two integers is the number of positions at which the corresponding bits are different.</p>
<p>Given two integers x and y, calculate the Hamming distance.</p>
<p>兩個等長字符串之間的漢明距離是兩個字符串對應位置的不同字符的個數。</p>
<p>現在給兩個整數 x, y ，計算出它們的漢明距離。</p>
<p>Note:<br> 0 ≤ x, y &lt; 231.</p>
<p>Example:</p>
<p> Input: x = 1, y = 4</p>
<p> Output: 2</p>
<p> Explanation:<br> 1   (0 0 0 1)<br> 4   (0 1 0 0)<br>        ?   ?</p>
<p> The above arrows point to positions where the corresponding bits are different.</p>
<p> 上面的 ？ 符號表示該 bits 不相同</p>
<h1 id="科普"><a href="#科普" class="headerlink" title="科普"></a>科普</h1><p>什麼是<a href="https://goo.gl/n4Cc69" target="_blank" rel="external">漢明距離 (Hamming distance)</a></p>
<p>漢明距離是以理察·衛斯里·漢明的名字命名的，漢明在誤差檢測與校正碼的基礎性論文中首次引入這個概念。在通信中累計定長二進位字中發生翻轉的錯誤數據位，所以它也被稱為信號距離。漢明重量分析在包括<code>資訊理論</code>、<code>編碼理論</code>、<code>密碼學</code>等領域都有應用。但是，如果要比較兩個不同長度的字符串，不僅要進行替換，而且要進行插入與刪除的運算，在這種場合下，通常使用更加複雜的編輯距離等算法。</p>
<h1 id="第一次解題-Accepted"><a href="#第一次解題-Accepted" class="headerlink" title="第一次解題 : Accepted"></a>第一次解題 : Accepted</h1><p>第一次解，想說把數字轉換成二位元字串<br>也就是使用 pad 這個方法取得兩個 binaryX 跟 binaryY<br>接下來就比對兩個字串每一個值是否有差異，就過了。。。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">hammingDistance</span><span class="params">(<span class="number">_</span> x: Int, <span class="number">_</span> y: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line"></div><div class="line">    <span class="comment">// How to convert Int to Binary in Swift : https://goo.gl/6m9TEY</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">pad</span><span class="params">(string : String, toSize: Int)</span></span> -&gt; <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">var</span> padded = string</div><div class="line">        <span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">0</span>..&lt;(toSize - string.characters.<span class="built_in">count</span>) &#123;</div><div class="line">            padded = <span class="string">"0"</span> + padded</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> padded</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">let</span> binaryX = pad(string: <span class="type">String</span>(x, radix: <span class="number">2</span>), toSize: <span class="number">32</span>)</div><div class="line">    <span class="keyword">let</span> binaryY = pad(string: <span class="type">String</span>(y, radix: <span class="number">2</span>), toSize: <span class="number">32</span>)</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> diff = <span class="number">0</span></div><div class="line">    </div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> binaryX.characters.<span class="built_in">indices</span> &#123;</div><div class="line">        <span class="keyword">let</span> c1 = binaryX.characters[i]</div><div class="line">        <span class="keyword">let</span> c2 = binaryY.characters[i]</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> c1 != c2 &#123;</div><div class="line">            diff += <span class="number">1</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> diff</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Other-Best-Practices"><a href="#Other-Best-Practices" class="headerlink" title="Other Best Practices"></a>Other Best Practices</h1><p>想想其實漢明距離就是要求兩個字符串的<a href="https://zh.wikipedia.org/wiki/%E9%80%BB%E8%BE%91%E5%BC%82%E6%88%96" target="_blank" rel="external">互斥或閘 (exclusive or)</a> </p>
<p>也就是 x ^ y 的答案</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">hammingDistance</span><span class="params">(<span class="number">_</span> x: Int, <span class="number">_</span> y: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">    <span class="keyword">let</span> <span class="built_in">c</span> = x ^ y</div><div class="line">    <span class="keyword">return</span> <span class="type">String</span>(<span class="built_in">c</span>, radix: <span class="number">2</span>).characters.<span class="built_in">filter</span> &#123; $<span class="number">0</span> == <span class="string">"1"</span>&#125;.<span class="built_in">count</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://windsuzu.github.io/leetcode-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jay Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Code">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/leetcode-1/" itemprop="url">
                  LeetCode#1 Two Sum - in Swift
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2017-07-22T09:18:56+08:00">
                2017-07-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/leetcode-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="leetcode-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>為了增進自己的基礎，從今天開始每天使用Swift解一題LeetCode。加油！</p>
<h1 id="題目"><a href="#題目" class="headerlink" title="題目"></a>題目</h1><p>Given an array of integers, return indices of the two numbers such that they add up to a specific target.</p>
<p>You may assume that each input would have exactly one solution, and you may not use the same element twice.</p>
<p>丟進一個整數陣列和一個目標值， 並且回傳一個整數陣列， 其中包含兩個數， 這兩個數的總和應該等於目標值</p>
<p>必須保證每一次輸入的數字都能夠有一個正確的答案， 並且不會重複使用同一個(元素 (第一次看成數字 X_X))</p>
<p>Example:<br> Given nums = [2, 7, 11, 15], target = 9,</p>
<p> Because nums[0] + nums[1] = 2 + 7 = 9,<br> return [0, 1]</p>
<h1 id="第一次提交-Time-Limit-Exceeded"><a href="#第一次提交-Time-Limit-Exceeded" class="headerlink" title="第一次提交 : Time Limit Exceeded"></a>第一次提交 : Time Limit Exceeded</h1><p>透過建立一個 Dictionary ，將陣列中每一個數配對一個 key ，<br>對 Dictionary 採用 key 由小到大迴圈 ， 並且再迴圈一次配對不同的 element (key != key2)，<br>只要兩者的值相同即為答案。</p>
<p>可惜第一次玩 Leetcode 發現居然有效率限制，這樣子的做法雖然可以解答，但是效率太差⋯⋯</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(<span class="number">_</span> nums: [Int], <span class="number">_</span> target: Int)</span></span> -&gt; [<span class="type">Int</span>] &#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> dict = [<span class="type">Int</span>: <span class="type">Int</span>]()</div><div class="line">    <span class="keyword">for</span> (index, element) <span class="keyword">in</span> nums.enumerated() &#123;</div><div class="line">        dict[index] = element</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (key, value) <span class="keyword">in</span> dict.sorted(by: &lt;) &#123;</div><div class="line">        <span class="keyword">for</span> (key2, value2) <span class="keyword">in</span> dict <span class="keyword">where</span> key != key2 &#123;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> value + value2 == target &#123;</div><div class="line">                <span class="keyword">return</span> [key, key2]</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> [<span class="number">0</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="第二次提交-Time-Limit-Exceeded"><a href="#第二次提交-Time-Limit-Exceeded" class="headerlink" title="第二次提交 : Time Limit Exceeded"></a>第二次提交 : Time Limit Exceeded</h1><p>第二次直接用暴力破解法，一樣雖然可以成功，<br>但是看來不是少個字典就可以呢… 花了 O(n^2) 的時間<br>又因為效率太差被拒絕了⋯⋯</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(<span class="number">_</span> nums: [Int], <span class="number">_</span> target: Int)</span></span> -&gt; [<span class="type">Int</span>] &#123;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">stride</span>(from: <span class="number">0</span>, to: nums.<span class="built_in">count</span>, by: <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">stride</span>(from: i+<span class="number">1</span>, to: nums.<span class="built_in">count</span>, by: <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">if</span> nums[j] == target - nums[i] &#123;</div><div class="line">                <span class="keyword">return</span> [i,j]</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> [<span class="number">0</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="第三次提交-Time-Limit-Exceeded"><a href="#第三次提交-Time-Limit-Exceeded" class="headerlink" title="第三次提交 : Time Limit Exceeded"></a>第三次提交 : Time Limit Exceeded</h1><p>一樣將數值跟第一次實作一樣存入 dictionary 中，<br>迴圈時，<br>算出目標值與目前數值的差 (complement)<br>直接去查看 dictionary 中有沒有符合 complement 的數字<br>有就是答案！ 回傳[答案的index, 跟現在數字的index]</p>
<p>其實第三次已經使用了 O(n) 的時間，但不知道為何還是效率太差 ?_?</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(<span class="number">_</span> nums: [Int], <span class="number">_</span> target: Int)</span></span> -&gt; [<span class="type">Int</span>] &#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> dict = [<span class="type">Int</span>: <span class="type">Int</span>]()</div><div class="line">    <span class="keyword">for</span> (index, element) <span class="keyword">in</span> nums.enumerated()  &#123;</div><div class="line"></div><div class="line">        <span class="keyword">let</span> complement = target - element</div><div class="line"></div><div class="line">        <span class="keyword">if</span> dict.values.<span class="built_in">contains</span>(complement) &#123;</div><div class="line">            <span class="keyword">return</span> [nums.index(of: complement)!, index]</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        dict[index] = element</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> [<span class="number">0</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="第四次提交-Accepted"><a href="#第四次提交-Accepted" class="headerlink" title="第四次提交 : Accepted"></a>第四次提交 : Accepted</h1><p>第四次手癢參考了一下<a href="https://github.com/raywenderlich/swift-algorithm-club/tree/master/Two-Sum%20Problem" target="_blank" rel="external">別人的做法</a></p>
<p><code>for i in 0..&lt;nums.count</code> 就可以用最快的速度得到迴圈跟 index<br>先看 else 的部分:<br>dict[算出目標值與目前數值的差] = 值的 index</p>
<p>之後的迴圈:<br>只要目前數值在 dict 當中出現，馬上知道是答案想要的差值<br>直接回傳 [差值, 現在的index]</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(<span class="number">_</span> nums: [Int], <span class="number">_</span> target: Int)</span></span> -&gt; [<span class="type">Int</span>] &#123;</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> dict = [<span class="type">Int</span>: <span class="type">Int</span>]()</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;nums.<span class="built_in">count</span> &#123;</div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> target = dict[nums[i]] &#123;</div><div class="line">            <span class="keyword">return</span> [target, i]</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            dict[target - nums[i]] = i</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> [<span class="number">0</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://windsuzu.github.io/learn-android-rxjava-with-retrofit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jay Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Code">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/learn-android-rxjava-with-retrofit/" itemprop="url">
                  學習 RxJava 結合 Retrofit
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2017-05-05T18:14:45+08:00">
                2017-05-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/learn-android-rxjava-with-retrofit/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="learn-android-rxjava-with-retrofit/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>個別學習完 RxJava 與 Retrofit 之後，是令人期待的合體了呢 ! </p>
<blockquote>
<p>前面的文章<br><a href="https://windsuzu.github.io/2017/05/02/learn-android-retrofit2/">學習 Android Retrofit 2</a><br><a href="https://windsuzu.github.io/2017/05/05/learn-android-rxjava/">學習 Android RxJava</a></p>
</blockquote>
<p>這篇文章僅僅是記錄如何將兩個框架結合在一起，不對兩者進行深入探討。</p>
<h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><p>設置 Gradle 除了 RxJava 與 Retrofit 的 Library 以外，還要再多設置讓兩者能夠結合的 adapter 套件。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">compile</span> <span class="string">"io.reactivex.rxjava2:rxjava:2.x.y"</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'io.reactivex.rxjava2:rxandroid:2.0.1'</span></div><div class="line"></div><div class="line"><span class="keyword">compile</span> <span class="string">'com.squareup.retrofit2:retrofit:2.2.0'</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'com.squareup.retrofit2:converter-gson:2.2.0'</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'com.squareup.retrofit2:adapter-rxjava2:2.2.0'</span></div></pre></td></tr></table></figure>
<blockquote>
<p>要記得 retrofit 與他的快樂夥伴的版本要一致 (2.2.0)</p>
</blockquote>
<p>在設置這邊發生了好多錯誤，原來之前學習時用的是 RxJava1，所以跟 Retrofit2 的 Adapter 配不起來 (汗)，1和2有一些差別，可以到 <a href="https://github.com/ReactiveX/RxJava/wiki/What%27s-different-in-2.0" target="_blank" rel="external">RxJava Github - What’s different in 2.0</a> 查看。</p>
<h2 id="實作-Retrofit-Service-Interface"><a href="#實作-Retrofit-Service-Interface" class="headerlink" title="實作 Retrofit Service Interface"></a>實作 Retrofit Service Interface</h2><p>一樣拿 GitHub Api 測試看看 :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GitHubService</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String BASEURL = <span class="string">"http://api.github.com/"</span>;</div><div class="line"></div><div class="line">    <span class="meta">@GET</span>(<span class="string">"users/&#123;userId&#125;"</span>)</div><div class="line">    <span class="function">Observable&lt;GitHubUser&gt; <span class="title">getUser</span><span class="params">(@Path(<span class="string">"userId"</span>)</span> String userId)</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>這邊要注意的是原本的 Call<githubuser> 變為 Observable<githubuser> ，因為是用 RxJava 觀察者模式訂閱，所以必須要返回一個 Observable 對象，才能夠進行接續的 <code>subscribeOn()</code> 、 <code>subScribe()</code> 等 RxJava 操作。其餘的都跟只有 Retrofit 時一樣。</githubuser></githubuser></p>
<h2 id="創建-Retrofit-元件"><a href="#創建-Retrofit-元件" class="headerlink" title="創建 Retrofit 元件"></a>創建 Retrofit 元件</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Retrofit <span class="title">provideRetrofit</span><span class="params">(String baseUrl)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Retrofit.Builder()</div><div class="line">            .addConverterFactory(GsonConverterFactory.create())</div><div class="line">            .addCallAdapterFactory(RxJava2CallAdapterFactory.create())</div><div class="line">            .baseUrl(baseUrl)</div><div class="line">            .build();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>這邊除了原本添加的 Gson 轉換器，還要新增 Retrofit 與 RxJava 相依的 RxJava2CallAdapterFactory 。</p>
<h2 id="實作-Retrofit-RxJava-異步網路請求"><a href="#實作-Retrofit-RxJava-異步網路請求" class="headerlink" title="實作 Retrofit + RxJava 異步網路請求"></a>實作 Retrofit + RxJava 異步網路請求</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">GitHubService service = provideRetrofit(GitHubService.BASEURL).create(GitHubService.class);</div><div class="line"></div><div class="line">service.getUser(USERID)</div><div class="line">        .subscribeOn(Schedulers.io())</div><div class="line">        .observeOn(AndroidSchedulers.mainThread())</div><div class="line">        .subscribe(user -&gt; Log.d(TAG, user.getName()));</div></pre></td></tr></table></figure>
<p>先利用 <code>getUser()</code> 獲得 Observable ，再開始使用 RxJava 的方法，能夠歷經 map 、 fliter 、 flatMap ，最後傳給 Observer 進行主執行緒的操作。</p>
<h2 id="結"><a href="#結" class="headerlink" title="結"></a>結</h2><p>除此之外，若是像設計登入流程，伺服器可能會先回傳一個 token ，需要再以 token 去取得用戶資料。這時可能就要使用 flatMap 再一次發送 token 取得資料。</p>
<p>或是登入時需要實作 <code>onError()</code> 的響應，一方面又想要維持 lambda 語法的簡潔，那就必須要另外新增兩個 <code>Action (Consumer)</code> ，來實作 <code>onNext()</code> 、 <code>onError()</code> 的方法，再放入 <code>subScribe</code> 中。</p>
<blockquote>
<p>上面說的登入設計可以參考這篇文章<br><a href="http://www.jianshu.com/p/1fb294ec7e3b" target="_blank" rel="external">【Android】RxJava + Retrofit完成网络请求</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://windsuzu.github.io/learn-android-rxjava/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jay Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Code">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/learn-android-rxjava/" itemprop="url">
                  學習 Android RxJava
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2017-05-05T16:14:07+08:00">
                2017-05-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/learn-android-rxjava/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="learn-android-rxjava/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>終於寫到了 RxJava ，前陣子在 <a href="https://juejin.im" target="_blank" rel="external">掘金</a> 不斷看到這個名字，一直想把他學起來應用在開發上。 看了好多文章，也實際操作，延伸學習了不少新的東西。像是更了解 Android 的執行緒、觀察者模式、 Java 8 的 lambda 語法。雖然我這個新手還沒有做過很大的 Project ，但相信 RxJava 會成為未來一個很棒的工具。</p>
<blockquote>
<p>好文參考<br><a href="http://www.jianshu.com/p/19cac3c5b106" target="_blank" rel="external">【Android】RxJava的使用（一）基本用法</a><br><a href="http://www.jianshu.com/p/6d1ef9f43cdc" target="_blank" rel="external">详细解析RxAndroid的使用方式</a><br><a href="http://gank.io/post/560e15be2dca930e00da1083#toc_15" target="_blank" rel="external">给 Android 开发者的 RxJava 详解 - 扔物线</a></p>
</blockquote>
<h2 id="為什麼要學習-RxJava"><a href="#為什麼要學習-RxJava" class="headerlink" title="為什麼要學習 RxJava"></a>為什麼要學習 RxJava</h2><p>記得什麼基礎都沒有時，為了要把網站的圖下載下來顯示到 imageView 中，使用了同步請求，把主執行緒塞爆 UI 當的要死。接著學習了 okhttp、Volley 這些 HTTP 請求的框架，知道了怎麼樣異步處理網路的請求。 但越寫越多，發現自己的程式碼亂七八糟，我也是懵了ㄎ &gt;_&gt;</p>
<p>RxJava 就是要讓 “異步操作” 更乾淨、簡潔的實作出來，而且比起 Android 內建的 AsyncTask 或 Handler 更能夠應付越寫越複雜的程式碼。搭配上 lambda 語法，就算是我這個懵逼寫的，看起來也變得很漂亮(哈哈)。</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>RxJava 的概念即是觀察者模式 (Observer Pattern) ，由觀察者 (Observer) 與被觀察者 (Subject) 組成。<br><img src="http://www.plantuml.com/plantuml/svg/Ux6yuUdw-IyQMdNjNYnQ_GB6Kx1IUB6YwUMqZGeQBrRiVjhMfSc5B0rKZAJoMST4iEIEvpFtFDdL1W00"></p>
<p><strong>觀察者</strong> 透過訂閱 (Subscribe) 或稱註冊 (Register) 的方式，監控著 <strong>被觀察者</strong> 。只要 <strong>被觀察者</strong> 一發生什麼變動，就馬上通知 <strong>觀察者</strong></p>
<p>就像 Button 註冊 OnClickListener 一樣 :<br><img src="http://www.plantuml.com/plantuml/svg/yyzppibCplR9B2v9pKijqhLpAYqfoSzJi58eJYtnHvNKqEI2oEhQeSa0bUT3H3Gq0G00"></p>
<p>RxJava 中的觀察者為 Observer ， 被觀察者為 Observable ， 訂閱的方法為 subscribe()，流程也是類似方式<br><img src="http://www.plantuml.com/plantuml/svg/yqygJYqgIotIjVC7inAJSb8Lh1IAIvEAauioar8rDBaG4Z15gKL09VbvhcMfUIKQcW00"></p>
<p>這邊要注意的是，這些方法在 java 中寫起來是長這樣的 :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">myButton.setOnClickListener(myOnClickListener);</div><div class="line">observable.subscribe(observer);</div></pre></td></tr></table></figure></p>
<p>咦? 這樣看起來不就是 observable 去訂閱 observer 嗎 ? 我也很納悶，在一篇文章這樣解釋著。<br><blockquote><p>有人可能會注意到， subscribe() 這個方法有點怪：它看起來是『observable 訂閱了 observer / subscriber』而不是『observer / subscriber 訂閱了 observalbe』，這看起來就像『雜志訂閱了讀者』一樣顛倒了對像關系。這讓人讀起來有點別扭，不過如果把 API 設計成 observer.subscribe(observable) / subscriber.subscribe(observable) ，雖然更加符合思維邏輯，但對流式 API 的設計就造成影響了，比較起來明顯是得不償失的。</p>
<footer><strong>扔物线</strong><cite><a href="https://gank.io/post/560e15be2dca930e00da1083" target="_blank" rel="external">給 Android 開發者的 RxJava 詳解</a></cite></footer></blockquote></p>
<p>好吧，看不太懂，還是先死記著好了。</p>
<hr>
<h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello, World !"></a>Hello, World !</h2><p>沒關係，先從最基本的回傳字串實際操作看看 !</p>
<h3 id="設置-Gradle"><a href="#設置-Gradle" class="headerlink" title="設置 Gradle"></a>設置 Gradle</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">compile</span> <span class="string">'io.reactivex:rxjava:1.0.14'</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'io.reactivex:rxandroid:1.0.1'</span></div></pre></td></tr></table></figure>
<h3 id="觀察者-Observer"><a href="#觀察者-Observer" class="headerlink" title="觀察者 Observer"></a>觀察者 Observer</h3><p>先從創建一個觀察者 Observer 看看 :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Observer&lt;String&gt; observer = <span class="keyword">new</span> Observer&lt;String&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">        Log.d(TAG, <span class="string">"Item: "</span> + s);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line">        Log.d(TAG, <span class="string">"Completed!"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">        Log.d(TAG, e.getMessage());</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>RxJava 的 Observable 發生改變時，會回傳給 Observer 三種方法，分別是 <code>OnNext()</code> 、 <code>OnComplete()</code> 、 <code>onError()</code> :</p>
<ul>
<li><p>OnNext() : Observable 發送過來的訊息，會批次的在這個方法中實現，就像 OnClick() 一樣。</p>
</li>
<li><p>OnComplete() : 當全部 OnNext() 都被執行完畢，會觸發這個方法。</p>
</li>
<li><p>onError() : 如果在執行的途中發生錯誤，會馬上執行這個方法，並且中止。</p>
</li>
</ul>
<h3 id="被觀察者-Observable"><a href="#被觀察者-Observable" class="headerlink" title="被觀察者 Observable"></a>被觀察者 Observable</h3><p>接著創建被觀察者 Observable<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Observable observable = Observable.create(<span class="keyword">new</span> Observable.OnSubscribe&lt;String&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Subscriber&lt;? <span class="keyword">super</span> String&gt; subscriber)</span> </span>&#123;</div><div class="line">        subscriber.onNext(<span class="string">"Hello!"</span>);</div><div class="line">        subscriber.onNext(<span class="string">"World!"</span>);</div><div class="line">        subscriber.onCompleted();</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>RxJava 使用 create() 創建一個 Observable，並且丟入參數 OnSubscribe 儲存回 Observable 中，當 Observable 被訂閱後，OnSubscribe 的 call() 方法就會被呼叫。</p>
<p>那如何訂閱呢 ? 前面有說過 :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">observable.subscribe(observer);</div><div class="line"><span class="comment">// LogCat 就會依序印出 "Hello!", "World!", "Completed!" 囉</span></div></pre></td></tr></table></figure></p>
<hr>
<h2 id="簡潔化"><a href="#簡潔化" class="headerlink" title="簡潔化"></a>簡潔化</h2><p>看完了最基礎的用法後，如果每次都要創建 Observer 跟 Observable ，再來 subscribe() 連結關係，絕對很煩阿 !<br>所以 RxJava 還有好多必學的用法。</p>
<h3 id="just"><a href="#just" class="headerlink" title="just"></a>just</h3><p>使用 Observable.just() 來創建 <strong>被觀察者</strong> ，與 Observable.create() 所產生的結果是一模一樣的。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Observable observable = Observable.just(<span class="string">"Hello!"</span>, <span class="string">"World!"</span>);</div><div class="line"><span class="comment">// 一樣會依序印出 "Hello!", "World!", "Completed!"</span></div></pre></td></tr></table></figure></p>
<h3 id="from"><a href="#from" class="headerlink" title="from"></a>from</h3><p>Observable.from() 則是能夠讀取繼承 <code>Iterable</code> 的所有類別如 <code>List</code>，並且拆開依序發送出來。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">String[] list = &#123;<span class="string">"Hello!"</span>, <span class="string">"World!"</span>&#125;;</div><div class="line">Observable observable = Observable.from(list);</div><div class="line"><span class="comment">// 一樣會依序印出 "Hello!", "World!", "Completed!"</span></div></pre></td></tr></table></figure></p>
<h3 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h3><p>簡化了 Observable 的方法後，再來是 Observer 這邊了。 subscribe(Observer) 需要回傳三種方法，在示範中，除了 <code>onNext()</code> 外，其實我們不怎麼需要回傳 <code>onComplete()</code> 與 <code>onError()</code> 。</p>
<p>所以 RxJava 提供了 Action 這個 Interface ，包含了 <code>Action0</code> 與 <code>Action1</code> 。</p>
<p><code>Action0</code> 與 <code>onComplete</code> 一樣是沒有參數與返回值的，因此可以利用 <code>Action0</code> 實作一個與 <code>onComplete</code> 一樣的方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Action0 onCompletedAction = <span class="keyword">new</span> Action0() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> </span>&#123;</div><div class="line">        Log.d(TAG, <span class="string">"Completed!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>而需要參數的 onError(err) 與 onNext(obj) ， 則利用相同需要傳入參數與返回值的 Action1 來實作。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Action1&lt;String&gt; onNextAction = <span class="keyword">new</span> Action1&lt;String&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">        Log.d(TAG, <span class="string">"Item: "</span> + s);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">Action1&lt;Throwable&gt; onErrorAction = <span class="keyword">new</span> Action1&lt;Throwable&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">        Log.d(TAG, e.getMessage());</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>再來就可以依照需要的 Action 傳入 subscribe() 當中 !<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 只需要定義 onNext()</span></div><div class="line">observable.subscribe(onNextAction); </div><div class="line"></div><div class="line"><span class="comment">// 以此類推</span></div><div class="line">observable.subscribe(onNextAction, onErrorAction);</div><div class="line">observable.subscribe(onNextAction, onErrorAction, onCompletedAction);</div></pre></td></tr></table></figure></p>
<p>練習總結這三種用法 :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createActions</span><span class="params">()</span> </span>&#123;</div><div class="line">        Observable.just(<span class="string">"Hello!"</span>, <span class="string">"World!"</span>).subscribe(<span class="keyword">new</span> Action1&lt;String&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">                Log.d(TAG, <span class="string">"Item: "</span> + s);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>哇嗚，變得簡潔好多 ! 如果再用之後的 lambda 語法將變得無比華麗呢。</p>
<hr>
<h2 id="變換函數"><a href="#變換函數" class="headerlink" title="變換函數"></a>變換函數</h2><p>什麼 ? 你說到現在只是用很炫的方式把字串 print 出來而已 ? 沒屌用 ?<br>現在才要開始看到 RxJava 真正厲害的地方啦 !</p>
<p>RxJava 提供 map 、 flatmap 、 reduce 等方法，將傳進來的每個對象或對象本身進行加工處理並且轉換。</p>
<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>如果我們有一用戶列表，要抓出全部用戶名字，並添加到新的 List<string> 當中，用一般做法，可能需要用到迴圈之類的麻煩事，但 <code>map()</code> 不需要 :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">User user1 = <span class="keyword">new</span> User();</div><div class="line">...</div><div class="line"></div><div class="line">Observable.just(user1, user2, user2)</div><div class="line"></div><div class="line">                <span class="comment">// 參數1 : 傳進來的類別</span></div><div class="line">                <span class="comment">// 參數2 : 轉換完輸出的類別</span></div><div class="line"></div><div class="line">                <span class="comment">// 讀進每個 User ， 並轉換為 name 這個 String 傳到下一個 subscribe 方法</span></div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;User, String&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">                        String name = user.getName();</div><div class="line">                        <span class="keyword">return</span> name;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                <span class="comment">// 將讀取的 name 加到新的 List 中</span></div><div class="line">                .subscribe(<span class="keyword">new</span> Action1&lt;String&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">                        nameList.add(s);</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div></pre></td></tr></table></figure></string></p>
<p>例子中的 <code>Func1</code> 這個 Interface ，跟 <code>Action1</code> 相似，同樣傳入參數進入的一個方法。不同的是， <code>Func1</code> 的 <code>call()</code> 是有返回值的 !<br>阿 ! 原來數字是多少就是有幾個返回值呢 ! <code>FuncX</code> 就有 X 個返回值 ! 懂了 !</p>
<h3 id="flatmap"><a href="#flatmap" class="headerlink" title="flatmap"></a>flatmap</h3><p>如果這時要把每個用戶的每個文章標題都列出來，用 <code>map()</code> 的做法會需要用到迴圈 :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Observable.just(user1, user2, user2)</div><div class="line">                .map(<span class="keyword">new</span> Func1&lt;User, List&lt;Article&gt;&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> List&lt;Article&gt; <span class="title">call</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">                        <span class="keyword">return</span> user.getArticleList();</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                <span class="comment">// 將轉換成 List&lt;Article&gt; 傳入 Observer 中</span></div><div class="line">                .subscribe(<span class="keyword">new</span> Action1&lt;List&lt;Article&gt;&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(List&lt;Article&gt; articleList)</span> </span>&#123;</div><div class="line">                        <span class="keyword">for</span> (Article a : articleList) &#123;</div><div class="line">                        	Log.d(TAG, a.getTitle());</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div></pre></td></tr></table></figure></p>
<p>噢 ! 由於 <code>map()</code> 只能夠實現 1對1 的轉換，所以出現另人煩躁的迴圈了。那要怎麼辦才能在 Observer 中每次都傳入一個 Article 類別呢 ? RxJava 還提供了一個 <code>flatmap()</code> 的方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Observable.just(user1, user2, user2)</div><div class="line"></div><div class="line">                <span class="comment">// User 類別將在 flatmap 中轉換成 Observable&lt;Article&gt; 類別</span></div><div class="line">                .flatmap(<span class="keyword">new</span> Func1&lt;User, Observable&lt;Article&gt;&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> Observable&lt;Article&gt; <span class="title">call</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">                        <span class="keyword">return</span> Observable.from(user.getArticleList());</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                <span class="comment">// 即可獲得序列中每個 Article</span></div><div class="line">                .subscribe(<span class="keyword">new</span> Action1&lt;Article&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Article article)</span> </span>&#123;</div><div class="line">                        Log.d(TAG, article.getTitle());</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div></pre></td></tr></table></figure></p>
<p><img src="/learn-android-rxjava/flatmap.jpg" alt="flatMap 示意圖"></p>
<p><font style="color: red">紅色代表 user1</font> ， <font style="color: purple">紫色代表 user2 </font></p>
<p><font style="color: red">user1</font> 進到 flatmap 後，經過新創建的 <font style="color: red"> Observable </font>將 <font style="color: red">Article1、Article2</font> 交給 Observer</p>
<p><font style="color: purple">user2</font> 進到 flatmap 後，經過新創建的 <font style="color: purple"> Observable </font>將 <font style="color: purple">Article3、Article4</font> 交給 Observer<br>很像一種 “鋪平” 的感覺，就是 flat 的意思。</p>
<h3 id="其他轉換函數"><a href="#其他轉換函數" class="headerlink" title="其他轉換函數"></a>其他轉換函數</h3><blockquote>
<p>filter : 過濾掉無意義的數據<br>reduce : 跟 flatmap 相反，把數個數組組合成一個數據<br>更多請參考 : <a href="https://www.zhihu.com/question/32209660" target="_blank" rel="external">谁来讲讲Rxjava、rxandroid中的操作符的作用?</a></p>
</blockquote>
<hr>
<h2 id="Scheduler"><a href="#Scheduler" class="headerlink" title="Scheduler"></a>Scheduler</h2><p>另外一個 RxJava 強大的原因，就是能夠隨意的切換執行緒 (Thread)。我們知道，如果要從事一些網路下載、加載圖片等較為耗時的工作，不能在 Android 的主執行緒，就是 UI 執行緒操作。所以會利用 Thread 或 AsyncTask 操作，類似這樣 :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 新增一個執行緒來處理圖片 </span></div><div class="line"><span class="keyword">new</span> Thread() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.run();</div><div class="line">        <span class="comment">// 遍步 folder 列表</span></div><div class="line">        <span class="keyword">for</span> (File folder : folders) &#123;</div><div class="line">            File[] files = folder.listFiles();</div><div class="line"></div><div class="line">            <span class="comment">// 遍步 file 列表</span></div><div class="line">            <span class="keyword">for</span> (File file : files) &#123;</div><div class="line"></div><div class="line">                <span class="comment">//  篩選 png 檔案</span></div><div class="line">                <span class="keyword">if</span> (file.getName().endsWith(<span class="string">".png"</span>)) &#123;</div><div class="line">                    <span class="keyword">final</span> Bitmap bitmap = getBitmapFromFile(file);</div><div class="line"></div><div class="line">                    <span class="comment">// 再回到 ui 執行緒添加圖片</span></div><div class="line">                    getActivity().runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">                        <span class="meta">@Override</span></div><div class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                            imageCollectorView.addImage(bitmap);</div><div class="line">                        &#125;</div><div class="line">                    &#125;);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;.start();</div></pre></td></tr></table></figure></p>
<p>但是 RxJava 提供 Scheduler 這個控制器，能夠切換執行緒，這邊先了解 Scheduler 的各種方法 :</p>
<ul>
<li><p>Schedulers.immediate() : 直接在當下的執行緒運行，就等於不切換，是默認的方法</p>
</li>
<li><p>Schedulers.newThread() : 像 new Thread() 一樣啟動一個新執行緒，並在裡面操作</p>
</li>
<li><p>Schedulers.io(): 便於 I/O 操作的執行緒，與 <code>newThread()</code> 差不多，主要用於讀取文件、db等工作</p>
</li>
<li><p>Schedulers.computation() : 計算時所使用的執行緒，要與 io 執行緒區別</p>
</li>
<li><p>AndroidSchedulers.mainThread() : 指定回 Android UI 主執行緒運行</p>
</li>
</ul>
<p>有了這些方法，就能夠在創建 Observable 時，使用 <code>subscribeOn()</code> 和 <code>observeOn()</code> 來進行切換控制。</p>
<ul>
<li><p>Observable.subscribeOn() : 指定 subscribe() 發生時所在的執行緒</p>
</li>
<li><p>Observable.observeOn() : 指定 subscribe() 返回時 Observer 為了消費事件所在的執行緒</p>
</li>
</ul>
<p>講了難懂，我們來用 RxJava 改造看看剛剛處理圖片的方法吧 :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 從 folders 取出每個 folder </span></div><div class="line"><span class="comment">// 再將每個 folder 中的 files 中的 file 各自取出</span></div><div class="line">Observable.from(folders)</div><div class="line">    .flatMap(<span class="keyword">new</span> Func1&lt;File, Observable&lt;File&gt;&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Observable&lt;File&gt; <span class="title">call</span><span class="params">(File file)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> Observable.from(file.listFiles());</div><div class="line">        &#125;</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    <span class="comment">// 過濾出檔名結尾為 .png 的檔案</span></div><div class="line">    .filter(<span class="keyword">new</span> Func1&lt;File, Boolean&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Boolean <span class="title">call</span><span class="params">(File file)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> file.getName().endsWith(<span class="string">".png"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    <span class="comment">// 將讀取的每個 File 轉成 Bitmap 輸出</span></div><div class="line">    .map(<span class="keyword">new</span> Func1&lt;File, Bitmap&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Bitmap <span class="title">call</span><span class="params">(File file)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> getBitmapFromFile(file);</div><div class="line">        &#125;</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    <span class="comment">// 規定以上這些 subscribe 中的工作，都要在 IO 執行緒 操作</span></div><div class="line">    .subscribeOn(Schedulers.io())</div><div class="line"></div><div class="line">    <span class="comment">// 而我們希望最後返回 Bitmap 並顯示在 imageView 的工作，回到 mainThread 執行</span></div><div class="line">    .observeOn(AndroidSchedulers.mainThread())</div><div class="line">    .subscribe(<span class="keyword">new</span> Action1&lt;Bitmap&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</div><div class="line">            <span class="comment">// 就是 call 裡面的工作在 mainThread 執行</span></div><div class="line">            imageCollectorView.addImage(bitmap);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div></pre></td></tr></table></figure></p>
<p>簡單的加入了 <code>subscribeOn()</code> 與 <code>observeOn()</code> 就讓執行緒能夠隨意切換，真棒 !</p>
<p>咦 ? 可是… 怎麼感覺程式碼變多了 ? </p>
<p>太在意這點是成不了大事的 ! 仔細看一遍，其實是邏輯變得簡單了呢 ! 程式碼中沒有任何迴圈什麼的，而且一條線的完成了整個工作，非常乾淨。重點是，若隔了好幾個月，突然要加入新的功能進來，用原本的方法寫的程式碼，又不愛加註解，可能要讀個幾分鐘才能搞懂吧 ! 而用 RxJava 的優勢就來了，一下就能搞懂自己當初在幹嘛，並且快速新增新功能進去 !</p>
<h2 id="Lambda"><a href="#Lambda" class="headerlink" title="Lambda"></a>Lambda</h2><p>或許在 <strong>「邏輯」</strong> 與 <strong>「程式碼」</strong> 的簡潔，需要有所取捨。 Java 8 所新增的 Lambda 語法能夠讓 <strong>程式碼</strong> 變得更簡潔，但相對的會較看不出他的邏輯。 或許應該把 Lambda 的學習在寫一篇文章的 … 不過先用看看，試著起到拋磚引玉的效果吧</p>
<h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><p>要使用 Java 8 的 Lambda 語法，需要在 app Gradle 中配置 (Android Studio 2.3)<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    defaultConfig &#123;</div><div class="line">    ...</div><div class="line">        jackOptions &#123;</div><div class="line">            enabled <span class="keyword">true</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    compileOptions &#123;</div><div class="line">        <span class="keyword">targetCompatibility</span> <span class="number">1.8</span></div><div class="line">        <span class="keyword">sourceCompatibility</span> <span class="number">1.8</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其實自己也還沒有很認真學習過 Java 8 的各種寫法，所以這邊先點出一些常用的方法 :</p>
<h3 id="lambda-語法"><a href="#lambda-語法" class="headerlink" title="lambda 語法"></a>lambda 語法</h3><p>這是一般要設定 setOnClickListener 時的做法，可以看到 new View.OnClickListener() 之後的 onClick 方法，看起來太礙眼了，尤其是要定義一堆一樣的 Listener 時，版面之混亂 &gt;_&gt;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">        Log.d(TAG, <span class="string">"Hello World!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>所以 lambda 語法，提供了一種匿名(Anonymous) 表達式。因為要創建一個 OnClickListener 時，固定只使用到 onClick 方法，並且只要帶入參數 View ，所以就可以簡化成 <code>(參數) -&gt; { 工作方法(參數) }</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">button.setOnClickListener(view -&gt; &#123;</div><div class="line">   Log.d(TAG, <span class="string">"Hello World!"</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 還可以更簡化</span></div><div class="line">button.setOnClickListener(view -&gt; Log.d(TAG, <span class="string">"Hello World!"</span>));</div><div class="line"></div><div class="line"><span class="comment">// 參數可以直接使用</span></div><div class="line">button.setOnClickListener(view -&gt; Log.d(TAG, view.getTag().toString()));</div></pre></td></tr></table></figure></p>
<h3 id="lambda-方法引用-method-reference"><a href="#lambda-方法引用-method-reference" class="headerlink" title="lambda 方法引用 (method reference)"></a>lambda 方法引用 (method reference)</h3><p>lambda 還能更簡化，這個方法就是方法引用 (method reference) ， 長這樣 <code>::</code> 。<br>用法就是，當你指定的 <code>工作方法</code> 中，那個參數跟你原本帶入的參數相同，就可以使用。<br>有點模糊，試試看 :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 假如我已經創建好一個方法來執行偵錯，只要帶入 View 就抓出他的 Tag 值</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">    Log.d(TAG, view.getTag().toString());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// lambda 就會知道這個方法可以直接使用</span></div><div class="line">button.setOnClickListener(<span class="keyword">this</span>::show);</div></pre></td></tr></table></figure></p>
<h3 id="實際在-RxJava-操作"><a href="#實際在-RxJava-操作" class="headerlink" title="實際在 RxJava 操作"></a>實際在 RxJava 操作</h3><p>學到這邊一定就知道， RxJava 有一堆 Action、Func 超煩的，來試試把他們簡化，一樣用剛剛處理圖片的流程 :</p>
<p>由於 map 與 subscribe 都已經有相對方法了，所以 Android Studio 還會問我們要不要改成 <code>方法引用</code> ，真貼心 !<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Observable.from(folders)</div><div class="line">                .flatMap(file -&gt; Observable.from(file.listFiles()))</div><div class="line">                .filter(file -&gt; file.getName().endsWith(<span class="string">".png"</span>))</div><div class="line">                .map(<span class="keyword">this</span>::getBitmapFromFile)</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(<span class="keyword">this</span>::showBitmap);</div></pre></td></tr></table></figure></p>
<p>哇塞，剛剛有一定長度的程式碼，就被縮減為 7 行，而且還保留一定的邏輯在，好有成就感阿 ! 嗯哈哈哈哈 !</p>
<hr>
<h2 id="結"><a href="#結" class="headerlink" title="結"></a>結</h2><p>學會這篇文章的內容，差不多就算入門了 RxJava ，不過 RxJava 還有很多東西可以學習，像是 RxBinding 或是與 Retrofit 一起使用等。這些在邊實作邊學習吧 ! 現在重要的是多用 RxJava 開發，熟能生巧 !</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://windsuzu.github.io/learn-android-retrofit2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jay Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Code">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/learn-android-retrofit2/" itemprop="url">
                  學習 Android Retrofit 2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2017-05-02T17:59:05+08:00">
                2017-05-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/learn-android-retrofit2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="learn-android-retrofit2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Retrofit 是什麼 ? 我也是學習 RxJava 途中才知道， Retrofit 跟 Volley 一樣是 Android 一種 HTTP 請求的框架，但實際操作了一遍，感覺比 Volley 還要更簡便，而且能夠支援 RxJava 的關係，必須要學習一下。</p>
<blockquote>
<p>好文參考<br><a href="http://www.jianshu.com/p/7efdc3477269" target="_blank" rel="external">【Android】Retrofit 2.0 的使用</a><br><a href="http://wuxiaolong.me/2016/01/15/retrofit/" target="_blank" rel="external">Android Retrofit 2.0使用</a><br><a href="http://www.jianshu.com/p/308f3c54abdd" target="_blank" rel="external">你真的会用Retrofit2吗?Retrofit2完全教程</a><br><a href="http://bxbxbai.github.io/2015/12/13/retrofit2/" target="_blank" rel="external">Retrofit2源碼解析</a></p>
</blockquote>
<h2 id="Retrofit-2-介紹"><a href="#Retrofit-2-介紹" class="headerlink" title="Retrofit 2 介紹"></a>Retrofit 2 介紹</h2><p>上面說到 Retrofit 2 為一種 HTTP 請求的工具，並且使用 REST API 設計，由 RESTful Client 向 Server 發出請求。</p>
<blockquote>
<p>有關 RESTful API 的相關文章<br><a href="http://www.ruanyifeng.com/blog/2014/05/restful_api.html" target="_blank" rel="external">RESTful API 设计指南</a><br><a href="http://ithelp.ithome.com.tw/articles/10157431" target="_blank" rel="external">定義 1 - 什麼是 REST/RESTful ?</a></p>
</blockquote>
<p><img src="/learn-android-retrofit2/retrofit.png" alt="Retrofit 模型"></p>
<ol>
<li>創建一個能裝載數據的 Class (Model or POJO)，</li>
<li>創建 Interface 來管理各種 HTTP APIs</li>
<li>最後創建 REST Client 發出請求，等待回傳 JSON 數據，使用內建的 Gson 解析序列</li>
</ol>
<hr>
<h2 id="Retrofit-2-基本的用法"><a href="#Retrofit-2-基本的用法" class="headerlink" title="Retrofit 2 基本的用法"></a>Retrofit 2 基本的用法</h2><h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><ul>
<li><p>Gradle 配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">compile 'com.squareup.retrofit2:retrofit:2.2.0'</div><div class="line">compile 'com.squareup.retrofit2:converter-gson:2.2.0'</div></pre></td></tr></table></figure>
</li>
<li><p>別忘了到 manifest 新增網路的權限</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span>/&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="創建裝載數據-Class"><a href="#創建裝載數據-Class" class="headerlink" title="創建裝載數據 Class"></a>創建裝載數據 Class</h3><p>這邊可以使用 Android Studio 的插件 GsonFormat ，輕鬆將 JSON 轉換為 JavaBean 類別。</p>
<p>安裝方法 -&gt; Settings -&gt; Plugins -&gt; Browse Repositories -&gt; 搜尋 GsonFormat -&gt; restart</p>
<p>新增空白的 Class 後 Alt + Insert</p>
<p><img src="/learn-android-retrofit2/gsonformat1.png" alt=""><br><img src="/learn-android-retrofit2/gsonformat2.png" alt=""></p>
<p>就能夠直接產生一個 JavaBean 的類別 !<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="keyword">private</span> String email;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> email;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.email = email;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="創建-Retrofit-物件與實作-Interface"><a href="#創建-Retrofit-物件與實作-Interface" class="headerlink" title="創建 Retrofit 物件與實作 Interface"></a>創建 Retrofit 物件與實作 Interface</h3><p>假設今天要到 <code>http://www.api.com/user/{userid}</code> 取得 user 的資料。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</div><div class="line">            .addConverterFactory(GsonConverterFactory.create()) <span class="comment">// 使用 Gson 解析</span></div><div class="line">            .baseUrl(<span class="string">"http://www.api.com/"</span>)</div><div class="line">            .build();</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApiService</span> </span>&#123;</div><div class="line">  <span class="comment">// 會返回一個 call 類別</span></div><div class="line">  <span class="meta">@GET</span>(<span class="string">"user/&#123;userid&#125;"</span>)</div><div class="line">  <span class="function">Call&lt;User&gt; <span class="title">getUser</span><span class="params">(@Path(<span class="string">"userid"</span>)</span> String userid)</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="創建要去請求-API-的-Client-Service"><a href="#創建要去請求-API-的-Client-Service" class="headerlink" title="創建要去請求 API 的 Client Service"></a>創建要去請求 API 的 Client Service</h3><ul>
<li><p>創建</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Api apiService = retrofit.create(ApiService.class);</div><div class="line">Call&lt;User&gt; call = apiService.getUser(<span class="string">"123"</span>);</div></pre></td></tr></table></figure>
</li>
<li><p>發出請求 (同步)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">User user = call.execute();</div></pre></td></tr></table></figure>
</li>
<li><p>發出請求 (異步)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;User&gt;()&#123;  </div><div class="line">         <span class="meta">@Override</span>  </div><div class="line">         <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Response&lt;User&gt; response)</span> </span>&#123;  </div><div class="line">             <span class="comment">//成功後，使用 response.body() 得到結果</span></div><div class="line">             User user = response.body();</div><div class="line">          &#125;  </div><div class="line">          <span class="meta">@Override</span>  </div><div class="line">          <span class="function"><span class="keyword">public</span> <span class="title">voidonFailure</span><span class="params">(Throwable t)</span> </span>&#123;  </div><div class="line">             <span class="comment">// 請求失敗</span></div><div class="line">         &#125;  </div><div class="line">     &#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="HTTP-API-不同的請求方法"><a href="#HTTP-API-不同的請求方法" class="headerlink" title="HTTP API 不同的請求方法"></a>HTTP API 不同的請求方法</h2><p>以下來自官方的文檔，作為記憶之用，請參考 <a href="http://square.github.io/retrofit/" target="_blank" rel="external">Retrofit Documentation</a></p>
<blockquote>
<p>另外可以參考<br><a href="https://bng86.gitbooks.io/android-third-party-/content/retrofit.html" target="_blank" rel="external">Retrofit · Android third-party 使用心得</a><br><a href="http://www.devwiki.net/2016/03/19/Retrofit-Use-Course-2/" target="_blank" rel="external">Retrofit使用教程(二) | DevWiki Blog</a></p>
</blockquote>
<h3 id="GET-METHOD"><a href="#GET-METHOD" class="headerlink" title="GET METHOD"></a>GET METHOD</h3><ul>
<li><p>假設要讀取用戶列表，不用用到任何參數</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GET</span>(<span class="string">"users/list"</span>)</div><div class="line">Call&lt;List&lt;User&gt;&gt; getUsers();</div></pre></td></tr></table></figure>
</li>
<li><p>可以帶入 query</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GET</span>(<span class="string">"users/list?sort=desc"</span>)</div></pre></td></tr></table></figure>
</li>
<li><p>URL 帶入參數</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GET</span>(<span class="string">"group/&#123;id&#125;/users"</span>)</div><div class="line">Call&lt;List&lt;User&gt;&gt; groupList(<span class="meta">@Path</span>(<span class="string">"id"</span>) <span class="keyword">int</span> groupId);</div></pre></td></tr></table></figure>
</li>
<li><p>若要邊帶入 URL 參數並且 query</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GET</span>(<span class="string">"group/&#123;id&#125;/users"</span>)</div><div class="line">Call&lt;List&lt;User&gt;&gt; groupList(<span class="meta">@Path</span>(<span class="string">"id"</span>) <span class="keyword">int</span> groupId, <span class="meta">@Query</span>(<span class="string">"sort"</span>) String sort);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="POST-METHOD"><a href="#POST-METHOD" class="headerlink" title="POST METHOD"></a>POST METHOD</h3><ul>
<li><p>假設要更新使用者資料，需要使用 <code>form-encoded</code> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@FormUrlEncoded</span></div><div class="line"><span class="meta">@POST</span>(<span class="string">"user/edit"</span>)</div><div class="line"><span class="function">Call&lt;User&gt; <span class="title">updateUser</span><span class="params">(@Field(<span class="string">"first_name"</span>)</span> String first, @<span class="title">Field</span><span class="params">(<span class="string">"last_name"</span>)</span> String last)</span>;</div></pre></td></tr></table></figure>
</li>
<li><p>需要利用 <code>multipart</code> 上傳文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Multipart</span></div><div class="line"><span class="meta">@PUT</span>(<span class="string">"user/photo"</span>)</div><div class="line"><span class="function">Call&lt;User&gt; <span class="title">updateUser</span><span class="params">(@Part(<span class="string">"photo"</span>)</span> RequestBody photo, @<span class="title">Part</span><span class="params">(<span class="string">"description"</span>)</span> RequestBody description)</span>;</div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<p>使用過 Retrofit 的確比 Volley 的用法更簡潔方便了，再來就要試試怎麼樣引入 RxJava 當中。多多實作再來了解其中的運作原理吧 !</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://windsuzu.github.io/learn-android-databinding/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jay Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Code">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/learn-android-databinding/" itemprop="url">
                  學習 Android Data Binding
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2017-04-29T12:56:49+08:00">
                2017-04-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/learn-android-databinding/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="learn-android-databinding/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>為了要在 Android 更方便的運作 NVVM 架構， Google 推出了 Data Binding 並且在 Android Studio 2.0.0 版本能夠正式的使用。</p>
<p>在還沒遇見 Data Binding 之前，例如要架構一個登入的 Activity ，必須要先去編寫 UI 的 XML ，並給每個需要與用戶互動的 View 一個 View ID 。建構好 UI 的部分後， 再去 java 編寫 findViewById() 、 setText() 、 setVisibility() 、 使用 Picasso 之類的第三方操作圖片⋯。</p>
<p>雖然我們可以利用 Butterknife 之類的 Library，降低大量重複煩躁的程式碼，但在更新時還是會同時干涉到 XML 與 java 。有了 Data Binding ，能夠進一步減輕開發的力氣，那就實際操作來學習看看吧。</p>
<blockquote>
<p>好文參考<br><a href="https://news.realm.io/cn/news/data-binding-android-boyar-mount/" target="_blank" rel="external">棉花糖給Android 帶來的Data Bindings</a><br><a href="https://goo.gl/iJhLb1" target="_blank" rel="external">Android Data Binding 系列(一) – 详细介绍与使用</a></p>
</blockquote>
<p>第一個網站為 Android Data Binding 發表的詳細講解，有詳細的講述 Data Binding 背後的運行，所以在這篇文章就不詳細探討，而是實作 Data Binding 的技術。</p>
<h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><p>在 app 的 build.gradle 新增 dataBinding<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    ....</div><div class="line">    dataBinding &#123;</div><div class="line">        enabled = true</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="最簡單的用法"><a href="#最簡單的用法" class="headerlink" title="最簡單的用法"></a>最簡單的用法</h2><h3 id="定義-Model"><a href="#定義-Model" class="headerlink" title="定義 Model"></a>定義 Model</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="定義-layout-檔"><a href="#定義-layout-檔" class="headerlink" title="定義 layout 檔"></a>定義 layout 檔</h3><p>Data Binding 的 layout 檔與以前的寫法不同了。view 不在需要 ID ，不需要再回到 java 依序配對。這表示在未來新增新的 UI 時，會變得更方便。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="comment">&lt;!-- 注目點 1 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span>&gt;</div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- 注目點 2 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span>  </div><div class="line">        <span class="tag">&lt;<span class="name">variable</span></span></div><div class="line">            <span class="attr">name</span>=<span class="string">"user"</span></div><div class="line">            <span class="attr">type</span>=<span class="string">"com.sekaij.ddpractice.User"</span>/&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></div><div class="line"></div><div class="line"> 	......</div><div class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</div><div class="line"></div><div class="line"> 	<span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                <span class="attr">android:text</span>=<span class="string">"@&#123;user.name&#125;"</span>     </div><div class="line">                <span class="attr">tools:text</span>=<span class="string">"username"</span> /&gt;</div><div class="line">                            <span class="comment">&lt;!-- 注目點 3 --&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h4><p>Data Binding 中的 layout 以 <code>&lt;layout&gt;</code> 作為最頂端的節點</p>
<h4 id="data"><a href="#data" class="headerlink" title="data"></a>data</h4><p>在 <code>&lt;data&gt;</code> 內定義與這個 layout 有相關互動的物件</p>
<h4 id=""><a href="#" class="headerlink" title="@{}"></a>@{}</h4><p>使用表達式 <code>@{}</code> 與物件產生連結。我們可以使用 tools 佈置介面。</p>
<h3 id="在-Activity-綁定數據"><a href="#在-Activity-綁定數據" class="headerlink" title="在 Activity 綁定數據"></a>在 Activity 綁定數據</h3><p>Data Binding 會依照 layout 檔自動產生 Binding 的 Class ，例如 <code>login_activity.xml</code> ，會產生一個名為 <code>(LoginActivity)Binding</code> 的 Class。</p>
<p>他代表了所有我們定義的綁定關係，所以必須在 inflate 創建他，後面在 recyclerView 也是如此。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ActivityMainBinding binding; <span class="comment">// 自動產生 binding 類別</span></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        binding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.activity_main);</div><div class="line"></div><div class="line">        User user = <span class="keyword">new</span> User(<span class="string">"Jay"</span>);</div><div class="line">        binding.setUser(user); <span class="comment">// 自動根據 data 中的 variable 產生方法</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="表達式"><a href="#表達式" class="headerlink" title="表達式"></a>表達式</h3><p>回到 <code>@{}</code> 表達式，除了可以利用如 <code>@{user.name}</code> 來綁定數據外，也可以加入一些簡單的邏輯運算。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">// 基本款</div><div class="line"><span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:text</span>=<span class="string">"@&#123;user.name&#125;"</span>/&gt;</span> </div><div class="line"></div><div class="line"></div><div class="line">// 可以加入 ”三元運算子“ 來判斷</div><div class="line"><span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:text</span>=<span class="string">"@&#123;user.age &lt; 18 ? @string/redacted : user.name&#125;"</span>/&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">// 也可以添加 View 來判斷 VISIBLE</div><div class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span> <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">"android.view.View"</span>/&gt;</span> <span class="tag">&lt;/<span class="name">data</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:visibility</span>=<span class="string">"@&#123;user.isAdult ? View.VISIBLE : View.GONE&#125;"</span>/&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">// 原本需要判斷是否為 null 的三元運算，也能夠使用合併運算符號 ?? 來判斷了</div><div class="line">contact.lastName != null ? contact.lastName : contact.name</div><div class="line"></div><div class="line">// 如果 lastName 為 null 就用 name ，不為空就使用自己</div><div class="line">contact.lastName ?? contact.name</div></pre></td></tr></table></figure></p>
<p>如果要引入資源時，則利用如 <code>@{@color/white}</code> 方式來引入。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">...</span> <span class="attr">android:background</span>=<span class="string">"@&#123;user.admin ? @color/colorAccent : @color/white&#125;"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">...</span> <span class="attr">android:padding</span>=<span class="string">"@&#123;isBig ? @dimen/bigPadding : @dimen/smallPadding&#125;"</span> /&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="事件處理-Event"><a href="#事件處理-Event" class="headerlink" title="事件處理 (Event)"></a>事件處理 (Event)</h2><h3 id="一般使用"><a href="#一般使用" class="headerlink" title="一般使用"></a>一般使用</h3><p>首先先定義 click Event 的類別。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventHandler</span> </span>&#123;</div><div class="line"></div><div class="line">        Context context;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">EventHandler</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.context = context;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// 因為綁定 view ， 所以需要設定參數 view</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClicked</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">            Toast.makeText(context, <span class="string">"Success ! "</span>, Toast.LENGTH_SHORT).show();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>別忘了 在 binding 中設定 handler ！<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">EventHandler handler = <span class="keyword">new</span> EventHandler(<span class="keyword">this</span>);</div><div class="line">binding.setHandler(handler);</div></pre></td></tr></table></figure></p>
<p>接著在 layout 檔定義 handler 的 variable ，並且代入 onclick<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">        <span class="tag">&lt;<span class="name">variable</span></span></div><div class="line">            <span class="attr">name</span>=<span class="string">"handler"</span></div><div class="line">            <span class="attr">type</span>=<span class="string">"com.sekaij.ddpractice.MainActivity.EventHandler"</span>/&gt;</div><div class="line"></div><div class="line">// 記得使用 `::` ， `.` 已經棄用</div><div class="line"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:onClick</span>=<span class="string">"@&#123;handler::onClicked&#125;"</span> /&gt;</span></div></pre></td></tr></table></figure></p>
<p>也可以使用 java 8 提供的 lambda 表達式<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:onClick</span>=<span class="string">"@&#123;(v) -&gt; handler.onClicked(v)&#125;"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 可以不帶入 view --&gt;</span></div><div class="line"><span class="comment">&lt;!-- public void onClicked() &#123;...&#125; --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:onClick</span>=<span class="string">"@&#123;() -&gt; handler.onClicked()&#125;"</span> /&gt;</span></div></pre></td></tr></table></figure></p>
<hr>
<h3 id="帶入函數"><a href="#帶入函數" class="headerlink" title="帶入函數"></a>帶入函數</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">User user = <span class="keyword">new</span> User(<span class="string">"Jay"</span>);</div><div class="line">binding.setUser(user);</div><div class="line"></div><div class="line">EventHandler handler = <span class="keyword">new</span> EventHandler(<span class="keyword">this</span>);</div><div class="line">binding.setHandler(handler);</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onButtonClicked</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">    Toast.makeText(view.getContext(), <span class="string">"Success ! "</span> + user.getName() + <span class="string">" 様"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:onClick</span>=<span class="string">"@&#123;() -&gt; handler.onButtonClicked(user)&#125;"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h2 id="可觀測性-Observable"><a href="#可觀測性-Observable" class="headerlink" title="可觀測性 Observable"></a>可觀測性 Observable</h2><p>Data Binding 還能夠在數據更新時，通知 UI 變動， 只需將要更新變動的 object 繼承 BaseObservable 類別<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">BaseObservable</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Bindable</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        notifyPropertyChanged(BR.name);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>BR 是編譯後產生的一個類別，會去尋找被標註 @Bindable 的 getter 方法，在 BR 中產生對應的值。<br>當數據更新後， <code>notifyPropertyChanged</code> 會通知系統 <code>BR.name</code> 已經變動，需要更新 UI 。</p>
<h3 id="ObservableFields"><a href="#ObservableFields" class="headerlink" title="ObservableFields"></a>ObservableFields</h3><p>如果覺得要設定 getter 與 setter 很麻煩，可以設定 ObservableField 以及衍生的 ObservableBoolean 、 ObservableInt ⋯ etc 。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObservableUser</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 一定要加 public final</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> ObservableField&lt;String&gt; name = <span class="keyword">new</span> ObservableField&lt;&gt;();</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> ObservableBoolean isAdmin = <span class="keyword">new</span> ObservableBoolean();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ObservableUser</span><span class="params">(String name, <span class="keyword">boolean</span> isAdmin)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name.set(name);</div><div class="line">        <span class="keyword">this</span>.isAdmin.set(isAdmin);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 定義</span></div><div class="line">ObservableUser observableUser = <span class="keyword">new</span> ObservableUser(<span class="string">"Jay"</span>, <span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// 取得值</span></div><div class="line">String name = observableUser.name.get();</div><div class="line"></div><div class="line"><span class="comment">// 設定值</span></div><div class="line">observableUser.name.set(<span class="string">"Wei"</span>);</div></pre></td></tr></table></figure></p>
<h3 id="ObservableArrayMap"><a href="#ObservableArrayMap" class="headerlink" title="ObservableArrayMap"></a>ObservableArrayMap</h3><p>我們還可以使用 key-value 來存取數據，Data Binding 提供了 ObservableArrayMap 類別。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ObservableArrayMap&lt;String, String&gt; item = <span class="keyword">new</span> ObservableArrayMap&lt;&gt;();</div><div class="line"></div><div class="line">item.put(<span class="string">"age"</span>, <span class="string">"20"</span>);</div><div class="line">binding.setItem(item);</div></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">variable</span></span></div><div class="line">    <span class="attr">name</span>=<span class="string">"item"</span></div><div class="line">    <span class="attr">type</span>=<span class="string">"android.databinding.ObservableArrayMap&amp;lt;String,String&amp;gt;"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- &amp;lt; 與 &amp;gt; 代替 &lt; &gt; ， 雖然會顯示錯誤 但編譯正常 --&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:text</span>=<span class="string">'@&#123;item["age"]&#125;'</span> /&gt;</span></div><div class="line"><span class="comment">&lt;!-- 使用 [] 讀取數據 --&gt;</span></div></pre></td></tr></table></figure>
<h2 id="BindingAdapter"><a href="#BindingAdapter" class="headerlink" title="BindingAdapter"></a>BindingAdapter</h2><p>除了基本的設定 setText 以外，當我們要設定圖片時怎麼辦，如果不是從 drawable 讀檔而是從 url ， 如果還想要使用 Picasso ， Glide 等第三方加載圖片時呢？ 這可以用 <code>BindingAdapter</code> 來解決！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomDataBindingAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@BindingAdapter</span>(<span class="string">"picasso"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setImageUrl</span><span class="params">(ImageView view, String url)</span> </span>&#123;</div><div class="line">        Picasso.with(view.getContext()).load(url).into(view);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">app:picasso</span>=<span class="string">"@&#123;user.imgURL&#125;"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>如此一來，我們就可以自己定義自己想要的 setter 了！</p>
<p>在 @BindingAdapter 註解的後面，也可以放入多個參數如 ：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@BindingAdapter</span>(&#123;<span class="string">"imageUrl"</span>, <span class="string">"error"</span>&#125;)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadImage</span><span class="params">(ImageView view, String url, Drawable error)</span> </span>&#123;</div><div class="line">    Glide.with(view.getContext()).load(url).error(error).into(view);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ImageView</span> </span></div><div class="line">    <span class="attr">app:imageUrl</span>=<span class="string">"@&#123;url&#125;"</span></div><div class="line">    <span class="attr">app:error</span>=<span class="string">"@&#123;@drawable/ic_launcher&#125;"</span>/&gt;</div></pre></td></tr></table></figure>
<h2 id="RecyclerView-運用"><a href="#RecyclerView-運用" class="headerlink" title="RecyclerView 運用"></a>RecyclerView 運用</h2><p>Data Binding 節省了 ViewHolder 的程式碼，不需要再定義 findViewById ，不需要 holder.location = … ，只需要使用 binding 類別給予的 inflate 進行綁定。</p>
<h3 id="定義-Observable-物件與-ClickHandler"><a href="#定義-Observable-物件與-ClickHandler" class="headerlink" title="定義 Observable 物件與 ClickHandler"></a>定義 Observable 物件與 ClickHandler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeZone</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> ObservableField&lt;String&gt; location = <span class="keyword">new</span> ObservableField&lt;&gt;();</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> ObservableField&lt;String&gt; time = <span class="keyword">new</span> ObservableField&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TimeZone</span><span class="params">(String loc, String time)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.location.set(loc);</div><div class="line">        <span class="keyword">this</span>.time.set(time);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TimeZoneClickHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onTimeZoneClick</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="定義-item-layout"><a href="#定義-item-layout" class="headerlink" title="定義 item layout"></a>定義 item layout</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">variable</span></span></div><div class="line">            <span class="attr">name</span>=<span class="string">"timeZone"</span></div><div class="line">            <span class="attr">type</span>=<span class="string">"com.sekaij.ddpractice.TimeZone"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">variable</span></span></div><div class="line">            <span class="attr">name</span>=<span class="string">"handler"</span></div><div class="line">            <span class="attr">type</span>=<span class="string">"com.sekaij.ddpractice.TimeZoneClickHandler"</span>/&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">        <span class="attr">android:layout_margin</span>=<span class="string">"16dp"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:onClick</span>=<span class="string">"@&#123;() -&gt; handler.onTimeZoneClick()&#125;"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">            <span class="attr">android:textColor</span>=<span class="string">"@android:color/darker_gray"</span></div><div class="line">            <span class="attr">android:text</span>=<span class="string">"@&#123;timeZone.location&#125;"</span></div><div class="line">            <span class="attr">tools:text</span>=<span class="string">"location"</span> /&gt;</div><div class="line"></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">            <span class="attr">android:text</span>=<span class="string">"@&#123;timeZone.time&#125;"</span></div><div class="line">            <span class="attr">tools:text</span>=<span class="string">"time"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="定義-ViewHolder"><a href="#定義-ViewHolder" class="headerlink" title="定義 ViewHolder"></a>定義 ViewHolder</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeZoneViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> RecyclerViewItemBinding binding;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TimeZoneViewHolder</span><span class="params">(RecyclerViewItemBinding binding)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(binding.getRoot());</div><div class="line">            <span class="keyword">this</span>.binding = binding;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bindTo</span><span class="params">(TimeZone timeZone)</span> </span>&#123;</div><div class="line">        	binding.setTimeZone(timeZone);</div><div class="line"></div><div class="line">            <span class="comment">// binding.setVariable(BR.timeZone, timeZone); </span></div><div class="line">            <span class="comment">// 如果在 xml 定義的 variable 是與他人共用相同的 data ，需要使用這個方法</span></div><div class="line"></div><div class="line">            binding.executePendingBindings();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHandler</span><span class="params">(<span class="keyword">final</span> Context context, <span class="keyword">final</span> TimeZone timeZone)</span> </span>&#123;</div><div class="line">            binding.setHandler(<span class="keyword">new</span> TimeZoneClickHandler() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimeZoneClick</span><span class="params">()</span> </span>&#123;</div><div class="line">                    String location = timeZone.location.get();</div><div class="line">                    String time = timeZone.time.get();</div><div class="line">                    Toast.makeText(context, location + <span class="string">" : "</span> + time, Toast.LENGTH_SHORT).show();</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>這邊需要注意的是 <font style="color:red"> executePendingBindings </font> 這個方法，當我們設定數據時，數據綁定要等到下一個動畫幀才會觸發，所以我們才需要這個方法，強制執行更新 UI。</p>
<h3 id="定義-Adapter"><a href="#定義-Adapter" class="headerlink" title="定義 Adapter"></a>定義 Adapter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeZoneRecyclerAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">TimeZoneRecyclerAdapter</span>.<span class="title">TimeZoneViewHolder</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ArrayList&lt;TimeZone&gt; timeZoneList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> Context context;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TimeZoneRecyclerAdapter</span><span class="params">(Context context, ArrayList&lt;TimeZone&gt; timeZoneList)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.context = context;</div><div class="line">        <span class="keyword">this</span>.timeZoneList = timeZoneList;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> TimeZoneViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</div><div class="line">        LayoutInflater layoutInflater = LayoutInflater.from(parent.getContext());</div><div class="line">        RecyclerViewItemBinding binding = RecyclerViewItemBinding.inflate(layoutInflater, parent, <span class="keyword">false</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TimeZoneViewHolder(binding);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(TimeZoneViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        holder.bindTo(timeZoneList.get(position));</div><div class="line">        holder.setHandler(context, timeZoneList.get(position));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> timeZoneList.size();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="結"><a href="#結" class="headerlink" title="結"></a>結</h2><p>Data Binding 讓我們能夠在 xml 定義一些表達式，讓 UI 跟 Activity 降低更多耦合，但也不代表我們能把全部的邏輯都放到 xml ， 然後不用再寫 java 。</p>
<p>例如我們不應該在 xml 使用一個發送網路訊息的功能。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">android:click</span>=<span class="string">"@&#123;webservice.sendMoneyAsync&#125;"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<p>我們應該只處理一些關於 UI 介面的事情。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">android:click</span>=<span class="string">"@&#123;presenter.onSendClick&#125;"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<p>到此，還有很多 Data Binding 與 DI 的運用，以及將 Data Binding 帶進更棒的 NVVM 架構，所以，多學吧！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://windsuzu.github.io/learn-android-dagger2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jay Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Code">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/learn-android-dagger2/" itemprop="url">
                  學習 Android 依賴注入框架 Dagger2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2017-04-23T14:06:51+08:00">
                2017-04-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/learn-android-dagger2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="learn-android-dagger2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>從上一篇 <a href="https://windsuzu.github.io/2017/04/22/learn-android-dependency-injection/">學習 Android 依賴注入 Dependency Injection (DI)</a> 我們知道，單純的手動使用 DI 進行編寫，會發生不斷依賴反而讓程式碼變得更複雜的問題。所以這次要來學習前人的智慧 DI 框架的使用，我選擇使用 Dagger2 作為學習的框架。不僅僅因為 Dagger2 的名聲響亮， Dagger2 除了被推崇為最好解決 Android DI 的框架，也適合進行單元測試，更棒的是網路上已經有大量的學習文章了！</p>
<blockquote>
<p>好文參考<br><a href="http://chriszou.com/2016/05/10/android-unit-testing-di-dagger.html" target="_blank" rel="external">小創作- Android單元測試（六）：使用dagger2來做依賴注入，以及在單元測試中的應用</a><br><a href="http://www.jianshu.com/p/cd2c1c9f68d4" target="_blank" rel="external">Android：dagger2讓你愛不釋手-基礎依賴注入框架篇</a></p>
</blockquote>
<h2 id="使用-Dagger2-流程"><a href="#使用-Dagger2-流程" class="headerlink" title="使用 Dagger2 流程"></a>使用 Dagger2 流程</h2><div id="flowchart-0" class="flow-chart"></div>

<h2 id="Inject"><a href="#Inject" class="headerlink" title="@Inject"></a>@Inject</h2><p>回到上次慘不忍睹的程式碼，不斷的創建造成開發效率變得很低。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> ModuleA moduleA;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    	<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        ModuleD moduleD = <span class="keyword">new</span> ModuleD();</div><div class="line">        ModuleE moduleE = <span class="keyword">new</span> ModuleE();</div><div class="line"></div><div class="line">        ModuleC moduleC = <span class="keyword">new</span> ModuleC(moduleE);</div><div class="line">        ModuleB moduleB = <span class="keyword">new</span> ModuleB(moduleC, moduleD);</div><div class="line"></div><div class="line">        moduleA = <span class="keyword">new</span> ModuleA(moduleB);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Dagger2 使用註解 (Annotations) 來標註 Client 所依賴的 dependency ，這個註解的名字稱作 @Inject 。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModuleA</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ModuleB moduleB;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ModuleA</span><span class="params">(ModuleB moduleB)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.moduleB = moduleB;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>同樣的，也用註解 @Inject 來標註 dependency 的 構造函數 (Constructor)<br>讓 Client 的 dependency 與 dependency 的 Constructor 產生無形的連結。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModuleB</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ModuleC moduleC;</div><div class="line">    <span class="keyword">private</span> ModuleD moduleD;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ModuleB</span><span class="params">(ModuleC moduleC, ModuleD moduleD)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.moduleC = moduleC;</div><div class="line">        <span class="keyword">this</span>.moduleD = moduleD;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Module"><a href="#Module" class="headerlink" title="@Module"></a>@Module</h2><p>另一種讓 dependency 之間產生無形連結的方法，就是透過 Module 。<br>Module 就像一個工廠一樣，我們統一在 Module 裡生產相關的 dependency。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationModule</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> ModuleA <span class="title">provideModuleA</span><span class="params">(ModuleB moduleB)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModuleA(moduleB);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> ModuleB <span class="title">provideModuleB</span><span class="params">(ModuleC moduleC, ModuleD moduleD)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModuleB(moduleC, moduleD);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> ModuleC <span class="title">provideModuleC</span><span class="params">(ModuleE moduleE)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModuleC(moduleE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> ModuleD <span class="title">provideModuleD</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModuleD();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> ModuleE <span class="title">provideModuleE</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModuleE();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Module 就是一個 Class ，不過這個 Class 需要用 @Module 來標註，讓 Dagger2 能夠判斷。<br>創建好 Module 後，就可以在 Module 中生產每個 dependency 了。</p>
<h3 id="Provides"><a href="#Provides" class="headerlink" title="@Provides"></a>@Provides</h3><p>既然 Module 是一個 Class ，那在 Module 中就可以有負責生產 dependency 的 Method ，也可以有負責做其他事情的 Method 。</p>
<p>這種專門為了生產 dependency 的 Method 稱作 Provider ，要利用 @Provides 標註。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationModule</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ModuleA <span class="title">provideModuleA</span><span class="params">(ModuleB moduleB)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModuleA(moduleB);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ModuleB <span class="title">provideModuleB</span><span class="params">(ModuleC moduleC, ModuleD moduleD)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModuleB(moduleC, moduleD);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ModuleC <span class="title">provideModuleC</span><span class="params">(ModuleE moduleE)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModuleC(moduleE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ModuleD <span class="title">provideModuleD</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModuleD();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ModuleE <span class="title">provideModuleE</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModuleE();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>@Provides 有一個好處，今天要使用 ModuleA 的時候，系統看到 ModuleA 需要 ModuleB ，就會去找其他 Provider ，看有沒有生產 ModuleB 的 Provider ，然後創建一個 ModuleB 給 ModuleA 使用。<br>如果 ModuleB 還需要其他 dependency ，系統就會繼續找下去，直到所有 dependency 都被滿足。</p>
<h3 id="Context"><a href="#Context" class="headerlink" title="Context ?"></a>Context ?</h3><p>那假如今天有一個 Provider 需要 Context 怎麼辦呢，例如 SharedPreferences 。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationModule</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Context context;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ApplicationModule</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.context = context;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Context <span class="title">provideContext</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> context;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ModuleD <span class="title">provideModuleD</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModuleD(context);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>之前說過 Module 也是 Class 的一種，那我在產生 Module 時，就可以利用 Module 的 Constructor 引入 Context 囉！</p>
<h2 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h2><p>知道了 @Module 和 @Inject 的用法，那要怎麼讓那些被 @Inject 與 @Module 的 dependency 產生直接的連結，然後在 Activity 上被更簡單的創建使用？</p>
<p>這就是 Component 大展身手的時候了， Component 扮演了 Injector 的角色，就像注入者一般把那些已經產生無形連結的 dependency 注入 Client 中。</p>
<p>Component 跟 Module 不同了， 不是 Class 而是 Interface 。當然，也要用 @Component 標註一下。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent</span> </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Component-與-Inject"><a href="#Component-與-Inject" class="headerlink" title="Component 與 Inject"></a>Component 與 Inject</h3><p>今天如果 ModuleA、B、C … 都已經做好 Constructor 的 Inject 時，那要怎麼在 MainActivity 實現 ModuleA 呢。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity mainActivity)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>首先要在 Component 裡定義一個 inject 的方法，意思就是告訴 Component 到 MainActivity 中，去找所有被 @Inject 的物件。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    ModuleA moduleA; <span class="comment">// Inject 的物件不能設為 private 不然 Component 會找不到</span></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        ApplicationComponent component = DaggerApplicationComponent.builder().build();</div><div class="line">        component.inject(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>dagger2 會對所有經過 @Component 標註過的 interface 進行處理，自動產生一個實現了這個 interface 的 Class ， Class 的名字就是 Component 的名字前面加上“Dagger”，例如 ApplicationComponent 就會變成 DaggerApplicationComponent 。</p>
<p>找到被 @Inject 註解的 ModuleA 之後，Component 繼續去找 ModuleA 的 dependency 被標註的 Constructor ，對應就是被 @Inject 標註的 ModuleB Constructor ，並創建 ModuleB 返回給 ModuleA 。一樣，如果 ModuleB 也有相對應的 dependency ， Component 也會不斷的找下去。</p>
<h3 id="Component-與-Module"><a href="#Component-與-Module" class="headerlink" title="Component 與 Module"></a>Component 與 Module</h3><p>實際操作時，可能會創建多個 Module 負責不同的 dependency ，也有可能有多個 Component 。<br>所以要怎麼讓 Component 知道去哪裡找 dependency 呢？<br>Dagger2 規定，我們必須要指定 Component 負責的 Module 是誰，就在 @Component 註解的後面定義。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span>(modules = &#123;ApplicationModule.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent</span> </span>&#123;</div><div class="line">    <span class="function">ModuleA <span class="title">moduleA</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果 MainActivity 需要 ModuleA ，那我們就在 Component 裡定義一個返回 ModuleA 的方法。<br>這樣一來， Component 在產生 ModuleA 的時候，就會到 Module 裡面去尋找 ModuleA 相關的 dependency ，一樣創建返回給 ModuleA。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ModuleA moduleA;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        ApplicationComponent component = DaggerApplicationComponent.builder().build();</div><div class="line">        moduleA = component.moduleA();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>呼叫 Module 中的 Provider 除了用這種方式，還可以用原本的 Inject 的方式操作。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity mainActivity)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Component 會到 MainActivity 找所有被 @Inject 的物件，然後回到 Module 中使用對應的 Provider ，在返回給物件。</p>
<h2 id="結"><a href="#結" class="headerlink" title="結"></a>結</h2><p>到這邊都只是用了簡單的 Inject、Module、Component 來完成 DI ，還有好多 Dagger2 的功能，像是 Singleton、Scope ，怎麼樣分配 Component 的工作，還沒有提到。希望在大量的練習之後，能夠更深入去分析 Dagger2。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://windsuzu.github.io/learn-android-dependency-injection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jay Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jay's Code">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/learn-android-dependency-injection/" itemprop="url">
                  學習 Android 依賴注入 Dependency Injection (DI)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2017-04-22T16:11:19+08:00">
                2017-04-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/軟體工程/" itemprop="url" rel="index">
                    <span itemprop="name">軟體工程</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/軟體工程/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/learn-android-dependency-injection/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="learn-android-dependency-injection/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前學到的幾種 Android 設計架構，都是為了要讓程式碼簡化，使得程式可讀性變高，以及更順利、簡單的進行單元測試。而在 <a href="http://chriszou.com/2016/05/06/android-unit-testing-di.html" target="_blank" rel="external">Android單元測試（五）：依賴注入，將mock方便的用起來</a> 這篇文章學習單元測試時，發現依賴注入 (Dependency Injection，DI)能夠讓單元測試變得更容易，甚至可以讓 App 的架構變得更乾淨。究竟 DI 是何方神聖，身為一個入門開發者一定要來學一下。</p>
<h2 id="什麼是依賴注入"><a href="#什麼是依賴注入" class="headerlink" title="什麼是依賴注入"></a>什麼是依賴注入</h2><p>根據 <a href="http://android.jobbole.com/82386/" target="_blank" rel="external">聊聊 Android 中的依賴注入</a> 這篇文章敘述，原來 DI 只是一種 設計模式 (design pattern) ，而且還有許多的框架可以使用。 DI 的目的就是讓開發者能夠寫出”低耦合“的程式碼，不但能更輕鬆的進行單元測試，也幫助維持整個 App 的架構。畢竟如果一款要生存長久的 App ，開發的時間就會越長，往往測試的效率就會慢慢地降低。所以善用 DI 來改善設計，增加可維護性、可拓展性、降低耦合，試著讓程式簡潔優雅一些吧。</p>
<h2 id="依賴注入的概念"><a href="#依賴注入的概念" class="headerlink" title="依賴注入的概念"></a>依賴注入的概念</h2><h3 id="什麼是-Dependency"><a href="#什麼是-Dependency" class="headerlink" title="什麼是 Dependency ?"></a>什麼是 Dependency ?</h3><p>在 DI 的觀念裡有兩個角色 : Client 、 Dependency ，如果在 App 裡面，有 A Class 用到了 B Class ，那麼 A 就是 Client ，而 B 則是 Dependency 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModuleA</span> </span>&#123;</div><div class="line">   <span class="keyword">private</span> ModuleB moduleB;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ModuleA</span><span class="params">()</span> </span>&#123;</div><div class="line">      moduleB = <span class="keyword">new</span> ModuleB();  <span class="comment">// A 產生了對 B 的 dependency</span></div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="什麼是-Injection"><a href="#什麼是-Injection" class="headerlink" title="什麼是 Injection ?"></a>什麼是 Injection ?</h3><p>上面的程式碼中， B 在外部已經創建好， 接著就像被注入 (Inject) 一般 set 到 Client 的 A裡面，這就算是 DI 的一種方式。但是在上面的例子中 A 和 B 之間還是存在高度耦合，不算是一個很好的 Injection ，一般常用的方法，是透過 client 的 Constructor 將 dependency 傳入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModuleA</span> </span>&#123;</div><div class="line">   <span class="keyword">private</span> ModuleB moduleB;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ModuleA</span><span class="params">(ModuleB moduleB)</span> </span>&#123;</div><div class="line">      <span class="keyword">this</span>.moduleB = moduleB;  <span class="comment">// 將 B 作為 A 的 Constructor 參數傳入</span></div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>現在，A Class 不需要知道如何去實現 B ，只要任何繼承了 B 的 Class 都可以傳入，降低兩者間的耦合。<br>到這邊就是 DI 的概念，簡單。</p>
<h2 id="依賴注入的問題"><a href="#依賴注入的問題" class="headerlink" title="依賴注入的問題"></a>依賴注入的問題</h2><p>習得了 DI 技能馬上就去打 Boss ，發現了一個天大的問題。如果你手動一個一個一個的新增 dependency ，你會發現、你會訝異，所有的 dependency 從最頂端的 Client 一直延伸開來。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// 如果原本的 ModuleB 也需要兩個 dependency C &amp; D</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModuleB</span> </span>&#123;</div><div class="line">   <span class="keyword">private</span> ModuleC moduleC;</div><div class="line">   <span class="keyword">private</span> ModuleD moduleD;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ModuleB</span><span class="params">(ModuleC moduleC, ModuleD moduleD)</span> </span>&#123;</div><div class="line">      <span class="keyword">this</span>.moduleC = moduleC;</div><div class="line">      <span class="keyword">this</span>.moduleD = moduleD;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>而 ModuleC 還需要 Module E !</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModuleC</span> </span>&#123;</div><div class="line">   <span class="keyword">private</span> ModuleE moduleE;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ModuleC</span><span class="params">(ModuleE moduleE)</span> </span>&#123;</div><div class="line">      <span class="keyword">this</span>.moduleE = moduleE;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>那可憐 Activity 要呼叫 ModuleA 時就會變成這樣 。･ﾟ･(つд`ﾟ)･ﾟ･<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> ModuleA moduleA;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    	<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        ModuleD moduleD = <span class="keyword">new</span> ModuleD();</div><div class="line">        ModuleE moduleE = <span class="keyword">new</span> ModuleE();</div><div class="line"></div><div class="line">        ModuleC moduleC = <span class="keyword">new</span> ModuleC(moduleE);</div><div class="line">        ModuleB moduleB = <span class="keyword">new</span> ModuleB(moduleC, moduleD);</div><div class="line"></div><div class="line">        moduleA = <span class="keyword">new</span> ModuleA(moduleB);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>有夠亂啊 !!!<br>還好，前人們在很早以前使用 DI 時早就出現了這樣的問題，所以早就有許多解決使用 DI 問題的框架。</p>
<h2 id="依賴注入的框架"><a href="#依賴注入的框架" class="headerlink" title="依賴注入的框架"></a>依賴注入的框架</h2><p>現在我們的問題是，如果有越來越多的 dependency 被我製造時，這些 dependency 可能會在不同的 client class 被 new 出來， 不但變得更複雜了，而且還重複了一堆程式碼。</p>
<p>而在 Java 的領域中，已經有很多框架幫助我們解決問題，例如最近流行的一種框架叫作 Dagger2 。</p>
<p>這些框架幫助我們建立一個類似 dependency 的工廠，所有的 dependency ，還是 dependency 的 dependency ，都要統一在這個工廠裡生產。所有要用到這些 dependency 的 client 就去這個工廠取得，而且 client 只需要知道他要用的 dependency 是誰，不需要知道他要的 dependency 又用了哪些 dependency ， 框架系統會自動幫我們判斷。</p>
<p>所以接著來學學怎麼使用 Dagger2 吧！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/10/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/12/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="Jay Wang" />
          <p class="site-author-name" itemprop="name">Jay Wang</p>
           
              <p class="site-description motion-element" itemprop="description">慢慢學習。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">114</span>
                <span class="site-state-item-name">文章</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">54</span>
                <span class="site-state-item-name">分類</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">43</span>
                <span class="site-state-item-name">標籤</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jay Wang</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  








  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://jays-code.disqus.com/count.js" async></script>
    

    

  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  

  

  

</body>
</html>
